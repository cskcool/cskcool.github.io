var te=Object.defineProperty;var ae=(e,u,n)=>u in e?te(e,u,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[u]=n;var C=(e,u,n)=>(ae(e,typeof u!="symbol"?u+"":u,n),n);import{N as oe,D as le,F as ne,M as re,O as se,f as ce,P as ie,Q as ue,R as de}from"./element-plus.cf6cd281.js";import{i as me}from"./is.84ee87a3.js";import{l as K,r as p,w as G,e as O,k as pe,T as ge,c as $,Y as R,S as h,P as x,u as c,o as D,F as T,a7 as H,R as z,L as fe,U as j,ak as W,V as X,a1 as Z,aa as he,d as ve,i as Y,a as _e,W as M,X as J}from"./@vue.0d442241.js";import{c as F,j as q,u as ye}from"./index.caafda5e.js";import{u as I}from"./vue-i18n.e8ea0993.js";const be=K({__name:"CForm",props:{options:{default:()=>[]},gutter:{default:24},colSpan:null,value:{default:{}},loading:{type:Boolean,default:!1}},emits:["submit","update:value"],setup(e,{expose:u,emit:n}){const r=e,g={input:"el-input",select:"el-select",inputNumber:"el-input-number",timePicker:"el-time-picker",datePicker:"el-date-picker",richText:"WangEditor"},E=["el-input","el-input-number","async-select"],i=p(),S=p({}),k=p([]),m=p({}),v=a=>a.map(o=>{let{name:V,type:_,tagName:y,...b}=o;return g[_]&&!y&&(y=g[_]),{...b,name:V,tagName:y}});G(()=>r.options,a=>{const o={};k.value=a.map(V=>{let{name:_,type:y,children:b,rules:t,tagName:f,...l}=V;return t&&(o[_]=t),y&&g[y]&&!f&&(f=g[y]),b&&me(b)&&(b=v(b)),{...l,name:_,tagName:f,children:b}}),S.value=o},{immediate:!0});const w=O(()=>{const a=r.options&&r.options.length>10?{md:12,xs:24}:{span:24};return r.colSpan||a});async function U(){var a;await((a=i.value)==null?void 0:a.validate(o=>{if(o){const V=r.value;n("submit",V)}}))}function A(...a){var o;(o=i.value)==null||o.validateField(...a)}function P(...a){var o;(o=i.value)==null||o.validate(...a)}function B(...a){var o;(o=i.value)==null||o.resetFields(...a)}function L(...a){var o;(o=i.value)==null||o.clearValidate(...a)}return u({validateField:A,validate:P,resetFields:B,clearValidate:L,submit:U}),G(()=>r.value,a=>{m.value=a},{immediate:!0}),pe(()=>{n("update:value",m.value)}),(a,o)=>{const V=oe,_=le,y=ne,b=re;return ge((D(),$("div",null,[R(c(se),x({ref_key:"formRef",ref:i,rules:c(S),model:e.value},a.$attrs),{default:h(()=>[R(y,{gutter:e.gutter},{default:h(()=>[(D(!0),$(T,null,H(c(k),(t,f)=>(D(),$(T,{key:f},[t.hidden?X("",!0):(D(),z(_,x({key:0},t.colSpan||c(w),{key:t.name}),{default:h(()=>[R(V,x({prop:t.name,label:t.label},t.itemExtra),{default:h(()=>{var l,d,N;return[t.scopedSlot&&a.$slots[t.scopedSlot]?fe(a.$slots,t.scopedSlot,{key:0,value:e.value,option:t}):t.tagName?(D(),$(T,{key:1},[E.includes(t.tagName)?(D(),z(j(t.tagName),x({key:0,modelValue:c(m)[t.name],"onUpdate:modelValue":s=>c(m)[t.name]=s,modelModifiers:{trim:!0}},t.props,W((l=t.on)!=null?l:{})),null,16,["modelValue","onUpdate:modelValue"])):t.children?(D(),z(j(t.tagName),x({key:1,modelValue:c(m)[t.name],"onUpdate:modelValue":s=>c(m)[t.name]=s,modelModifiers:{trim:!0}},t.props,W((d=t.on)!=null?d:{})),{default:h(()=>[(D(!0),$(T,null,H(t.children,(s,ee)=>{var Q;return D(),z(j(s.tagName),x({key:ee},s.props,W((Q=s.on)!=null?Q:{})),null,16)}),128))]),_:2},1040,["modelValue","onUpdate:modelValue"])):(D(),z(j(t.tagName),x({key:2,modelValue:c(m)[t.name],"onUpdate:modelValue":s=>c(m)[t.name]=s},t.props,W((N=t.on)!=null?N:{})),null,16,["modelValue","onUpdate:modelValue"]))],64)):X("",!0)]}),_:2},1040,["prop","label"])]),_:2},1040))],64))),128))]),_:3},8,["gutter"])]),_:3},16,["rules","model"])])),[[b,e.loading]])}}});class we{constructor(u){C(this,"dataSource",p([]));C(this,"loading",p(!1));C(this,"ids",p([]));C(this,"queryParam",p());C(this,"url",p({}));C(this,"modalFormRef",p());C(this,"drawerFormRef",p());C(this,"ipagination",Z({current:1,total:0,pageSize:10,pageSizeOptions:[5,10,20,50,100]}));this.url.value=u}}function Ve(e){const u=new we(e),{t:n}=I(),{dataSource:r,ipagination:g,loading:E,queryParam:i,ids:S,modalFormRef:k,drawerFormRef:m}=he(Z(u)),v=()=>({page:g.value.current,pageSize:g.value.pageSize,...i.value}),w=async(l=!1)=>{if(!e.list){F("error",n("page.common.notice.set_url_list"));return}l&&(g.value.current=1);const d=v();try{E.value=!0;const N=await q.get(e.list,d);r.value=N.data,g.value.total=Number(N.total)}finally{E.value=!1}},U=()=>{k.value.edit({}),k.value.title=n("page.common.title.add")},A=l=>{i.value=l,w(!0)},P=()=>{i.value={},w(!0)},B=(l,d=n("page.common.title.edit"))=>{k.value.edit(l),k.value.title=d},L=async l=>new Promise(async(d,N)=>{try{if(!e.add){F("error",n("page.common.notice.set_url_add"));return}const s=await q.post(e.add,{data:l});s.code===200&&s.data.count>0&&d(s)}catch(s){N(s)}}),a=async l=>new Promise(async(d,N)=>{try{if(!e.edit){F("error",n("page.common.notice.set_url_edit"));return}const s=await q.put(e.edit,{data:l});s.code===200&&s.data.count>0&&d(s)}catch(s){N(s)}}),o=async l=>{if(!e.delete){F("error",n("page.common.notice.set_url_delete"));return}const d=await q.delete(`${e.delete}/${l}`);d.code===200&&d.data.count>0&&(F("success",n("page.common.notice.delete_success")),w(!0))},V=async()=>{if(!e.batchDelete){F("error",n("page.common.notice.set_url_batchDelete"));return}if(S.value.length===0){F("error",n("page.common.notice.empty_delete_data"));return}const l=await q.delete(e.batchDelete,{ids:S.value.join(",")});l.code===200&&l.data.count>0&&(F("success",n("page.common.notice.batchDelete_success")),w(!0))},_=()=>{m.value.add(),m.value.title=n("page.common.title.add")},y=(l,d=n("page.common.title.edit"))=>{m.value.edit(l),m.value.title=d},b=l=>{g.value.pageSize=l,w()},t=l=>{g.value.current=l,w()},f=l=>{S.value=c(l).map(d=>d.id)};return ve(async()=>{await w(!0)}),{loadData:w,handleOpenAddDialog:U,handleOpenEditDialog:B,handleReset:P,handleAdd:L,handleEdit:a,handleDelete:o,handleBatchDelete:V,handleSearch:A,handleOpenAddDialogDrawer:_,handleOpenEditDialogDrawer:y,handleSizeChange:b,handleCurrentChange:t,handleSelectionChange:f,dataSource:r,ids:S,ipagination:g,modalFormRef:k,loading:E}}const Se={list:"/article",delete:"/article",batchDelete:"/article",edit:"/article",add:"/article"},xe=()=>{const{t:e}=I(),u=O(()=>[{label:e("page.common.design.article.search.title"),name:"title",tagName:"el-input",props:{placeholder:e("page.common.design.article.search.title_placeholder"),maxLength:"24"}},{label:e("page.common.design.article.search.content"),name:"content",tagName:"el-input",props:{placeholder:e("page.common.design.article.search.content_placeholder"),maxLength:"24"}},{label:e("page.common.design.article.search.type"),name:"type",tagName:"async-select",props:{placeholder:e("page.common.design.article.search.type_placeholder"),url:"/article/type",size:"default",style:{width:"100%"}}}]),n=O(()=>[{type:"selection",show:!0,width:"55"},{prop:"id",show:!0,label:e("page.common.design.article.column.id"),width:"80"},{prop:"title",show:!0,label:e("page.common.design.article.column.title"),width:"180"},{prop:"content",show:!0,label:e("page.common.design.article.column.content"),showOverflowTooltip:!0},{prop:"actions",show:!0,label:e("page.common.design.article.column.action"),fixed:"right",scoped:"actions",width:"150"}]);return{articleFilterOptions:u,articleColumns:n}},ke={class:"dialog-footer"},Pe=K({__name:"ArticleEditDialog",emits:["close"],setup(e,{expose:u,emit:n}){const{t:r}=I(),{handleEdit:g,handleAdd:E}=Ve(Se),i=p(!1),S=p(),k=p(""),{gtMd:m}=ye(),v=p({}),w=O(()=>v.value.id!==void 0),U=O(()=>m.value?"50%":"80%");function A(a){v.value=Object.assign({},a),i.value=!0}function P(){var a;(a=S.value)==null||a.clearValidate(),i.value=!1}async function B(a){!a||await a.validate(o=>{o&&(w.value?g(v.value).then(()=>{F("success",r("page.common.notice.edit_success")),n("close"),i.value=!1}):E(v.value).then(()=>{F("success",r("page.common.notice.add_success")),n("close"),i.value=!1}))})}const L=O(()=>[{name:"title",type:"input",label:r("page.common.design.article.form.title"),rules:[{required:!0,message:r("page.common.design.article.form.title_placeholder"),trigger:"blur"}],props:{maxLength:50,placeholder:r("page.common.design.article.form.title_placeholder")}},{name:"content",type:"input",label:r("page.common.design.article.form.content"),rules:[{required:!0,message:r("page.common.design.article.form.content_placeholder"),trigger:"blur"}],props:{autosize:{minRows:4,maxRows:8},type:"textarea",placeholder:r("page.common.design.article.form.content_placeholder")}},{name:"type",label:r("page.common.design.article.form.type"),rules:[{required:!0,message:r("page.common.design.article.form.type_placeholder"),trigger:"blur"}],scopedSlot:"type"}]);return u({edit:A,title:k}),(a,o)=>{const V=ce,_=ie,y=ue,b=be,t=de;return D(),z(t,{modelValue:c(i),"onUpdate:modelValue":o[3]||(o[3]=f=>Y(i)?i.value=f:null),width:c(U),title:c(k),onClose:P},{footer:h(()=>[_e("span",ke,[R(V,{onClick:P},{default:h(()=>[M(J(c(r)("page.common.btn.cancel")),1)]),_:1}),R(V,{type:"primary",onClick:o[0]||(o[0]=f=>B(c(S)))},{default:h(()=>[M(J(c(r)("page.common.btn.confirm")),1)]),_:1})])]),default:h(()=>[R(b,{ref_key:"ruleFormRef",ref:S,value:c(v),"onUpdate:value":o[2]||(o[2]=f=>Y(v)?v.value=f:null),"label-width":"80px",options:c(L)},{type:h(()=>[R(y,{modelValue:c(v).type,"onUpdate:modelValue":o[1]||(o[1]=f=>c(v).type=f),class:"ml-4"},{default:h(()=>[R(_,{label:"history",size:"large"},{default:h(()=>[M("\u5386\u53F2")]),_:1}),R(_,{label:"literature",size:"large"},{default:h(()=>[M("\u6587\u5B66")]),_:1}),R(_,{label:"technology",size:"large"},{default:h(()=>[M("\u79D1\u6280")]),_:1})]),_:1},8,["modelValue"])]),_:1},8,["value","options"])]),_:1},8,["modelValue","width","title"])}}});export{be as _,Se as a,Pe as b,xe as s,Ve as u};
